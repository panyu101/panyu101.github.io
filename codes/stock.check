#!/bin/bash

#STOCK=GILD;PRICE=postMarketPrice;wget -O temp --quiet "https://ca.finance.yahoo.com/quote/$STOCK?p=$STOCK&.tsrc=fin-srch";cat temp|sed 's|,"|\n|g'|grep "$PRICE"|sed 's|.*raw":||g';rm -f temp
# the regularMarketPrice is hard to parse dur to multiple value, so skip it
#STOCK=GILD;PRICE=regularMarketPrice;wget -O temp --quiet "https://ca.finance.yahoo.com/quote/$STOCK?p=$STOCK&.tsrc=fin-srch";cat temp|sed 's|,"|\n|g'|grep "$PRICE"|awk '/regularMarketPrice/{i++}i==16{print; exit}'|sed 's|.*raw":||g';rm -f temp

TYPE=postMarketPrice
for STOCK in GILD
  do
  PRICE=$(wget -O temp --quiet "https://ca.finance.yahoo.com/quote/$STOCK?p=$STOCK&.tsrc=fin-srch";cat temp|sed 's|,"|\n|g'|grep postMarketPrice|sed 's|.*raw":||g';rm -f temp)
  curl -i -XPOST "http://127.0.0.1:8086/write?db=Stock" --data-binary "$STOCK type=$TYPE,price=$PRICE"
done
