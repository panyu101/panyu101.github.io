<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <link rel="stylesheet" type="text/css" href="cli.css">
  <title>CLI</title>
</head>
<body>
<pre><qsuba>665_panyu101.github.io static website
</qsuba><qsubb>###
</qsubb>FOLDER=panyu101.github.io;tree -L 1 -I 'index*|zz*|pdq*|*php' -T $FOLDER -H . | sed '/&lt;p class=&quot;VERSION&quot;&gt;/,+5d' &gt; pdq.html
eval &quot;$(ssh-agent -s)&quot;
ssh-add /root/key/panyu101.rsa
ssh -T git@github.com
git add -A;git commit -m &quot;$(date)&quot;
git config --global user.email &quot;panyu101@outlook.com&quot;
git push -u origin main
<qsubb>###
</qsubb>
<qsuba>664_sync current directory to AWS S3 static website
</qsuba><qsubb>###
</qsubb>F=$(basename $(pwd));export AWS_PROFILE=ratox;aws s3 sync . s3://alex.eboy.work/audio/$F --delete --exclude zz --region us-west-2
<qsubb>###
</qsubb>
<qsuba>663_bash sort file employee by year, month, day of onboard:	sort -t ',' -nr -k4 -k5 -k6 employees
</qsuba>
<qsuba>662_bash process list of record in mutiple-lines:
</qsuba><qsubb>###
</qsubb>while read first;read second;read third;do echo $first, $second, $third;done &lt; list.three.lines.per.record
<qsubb>###
</qsubb>
<qsuba>661_neat way to pass config to main.py:
</qsuba><qsubb>###
</qsubb>; make a cfg/server.py looks like:

url     = &quot;http://10.74.156.122/zabbix/api_jsonrpc.php&quot;
user    = &quot;Admin&quot;
passwd  = &quot;zabbix&quot;

; then you can import it to main.py, and refer these variables as:
url = zbx.url
user = zbx.user
passwd = zbx.passwd
; etc.
<qsubb>###
</qsubb>
<qsuba>660_Python import XXX.py from other place than main.py located:
</qsuba><qsubb>###
</qsubb>; say you have config file located at cfg/server.py, then you have to do:

import sys
sys.path.insert(1, './cfg')
import server as zbx
<qsubb>###
</qsubb>
<qsuba>659_very basic config for /etc/zabbix/zabbix_agentd.conf
</qsuba><qsubb>###
</qsubb>PidFile=/var/run/zabbix/zabbix_agentd.pid
LogFile=/var/log/zabbix/zabbix_agentd.log
LogFileSize=0
Server=10.74.156.46
ServerActive=10.74.156.46
Include=/etc/zabbix/zabbix_agentd.d/*.conf
<qsubb>###
</qsubb>
<qsuba>658_running mysql in safe mode, NO authentication at all:	mysqld_safe --skip-grant-tables &amp;
</qsuba>
<qsuba>657_installl mysql on Amazon Linux:
</qsuba><qsubb>###
</qsubb>ps aux | grep mysql
yum -y install mariadb-server
systemctl enable --now mariadb
ps aux | grep mysql

mysql
<qsubb>###
</qsubb>
<qsuba>656_install and configure Apprise on Nagios server:		# NOT very useful !
</qsuba><qsubb>###
</qsubb>; install and setup
python --version
yum install python2-pip
pip install apprise
mkdir -p /etc/nagios/conf.d
touch /etc/nagios/conf.d/dummy.cfg
nn /etc/nagios/conf.d/apprise.cfg				# content see: https://github.com/panyu101/nagios.kpadm01/blob/main/conf.d/apprise.cfg
nn /etc/nagios/objects/contacts.cfg
nagios -v /etc/nagios/nagios.cfg
systemctl reload nagios.service

; configurate
nn /etc/nagios/apprise.yml					# content see: https://github.com/panyu101/nagios.kpadm01/blob/main/apprise.yml

; test it
apprise -c /etc/nagios/apprise.yml -n failure -g PROBLEM -vvv -t &quot;A Test Title&quot; -b &quot;a Test Body&quot;
<qsubb>###
</qsubb>
<qsuba>655_php session files clean up:
</qsuba><qsubb>###
</qsubb>default session files location:
/tmp/systemd-private-c45041af218a47c1a610945da3ff89ca-php-fpm.service-WGj3NQ/tmp/
clean up:
rm -fv /tmp/systemd-private-c45041af218a47c1a610945da3ff89ca-php-fpm.service-WGj3NQ/tmp/*
<qsubb>###
</qsubb>
<qsuba>654_nano super easy and powerful shortcut:
</qsuba><qsubb>###
</qsubb>Ctrl+r		File to insert [from ./]: FILE_NAME
Ctrl+rx		Command to execute: BASH_COMMAND

either way, the content/result of FILE_NAME or BASH_COMMAND output will be insert into the current position of nano
<qsubb>###
</qsubb>
<qsuba>653_make Dokuwiki open external link in new tab:
</qsuba><qsubb>###
</qsubb>Edit file: /var/www/html/wiki/conf/dokuwiki.php
---
Modify the line from:
  $conf['target']['extern']    = '';
  
to:
  $conf['target']['extern']    = '_blank';
---
<qsubb>###
</qsubb>
<qsuba>652_bash script return for Nagios check:			# ONLY the status, NO perfdata in this example
</qsuba><qsubb>###
</qsubb>case $EXIT in
  0)
    echo &quot;OK - $METRIC_NAME (${MINUTES} min $STATISTICS): $METRIC$UNIT&quot;
    exit $EXIT
    ;;
  1)
    echo &quot;WARNING - $METRIC_NAME (${MINUTES} min $STATISTICS): $METRIC$UNIT&quot;
    exit $EXIT
    ;;
  2)
    echo &quot;CRITICAL - $METRIC_NAME (${MINUTES} min $STATISTICS): $METRIC$UNIT&quot;
    exit $EXIT
    ;;
  *)
    echo &quot;UNKNOWN - $METRIC_NAME (${MINUTES} min $STATISTICS): $METRIC$UNIT&quot;
    exit 3
    ;;
esac
<qsubb>###
</qsubb>
<qsuba>651_bash command line option parse:				# command -p $ARG1$ -n $ARG2$ -i $ARG3$
</qsuba><qsubb>###
</qsubb>while getopts &quot;p:n:i:&quot; opt; do
  case &quot;$opt&quot; in
    p)
      PROFILE=$OPTARG
      ;;
    n)
      NAMESPACE=&quot;AWS/$OPTARG&quot;
      ;;
    i)
      INSTANCE=$OPTARG
      if [[ $NAMESPACE =~ &quot;RDS&quot; ]]; then
        DIMENSIONS=&quot;Name=DBInstanceIdentifier,Value=$OPTARG&quot;
      fi
      if [[ $NAMESPACE =~ &quot;ElastiCache&quot; ]]; then
        DIMENSIONS=&quot;Name=CacheClusterId,Value=$OPTARG&quot;
      fi
      ;;
  esac
done
<qsubb>###
</qsubb>
<qsuba>650_bash set default for a variable:				echo $REGION;[[ ! $REGION ]] &amp;&amp; REGION=&quot;us-west-2&quot;;echo $REGION
</qsuba>
<qsuba>649_ignore files OR directoris when commit/push to Github:
</qsuba><qsubb>###
</qsubb>cd TARGET_DIR
rm -rf .git*							# if git initialized before and to start over again
git init
nn .gitignore							# add simple line, like var/, means to ignore directory var/
								# or something like:  * \ !this_one, means to ignore ALL but not this_one
git add -A;git commit -m &quot;$(date)&quot;;git branch -M main;git remote add origin git@github.com:panyu101/nagvis.kpadm01.git
git push -u origin main

For ANY change made under TARGET_DIR
git add -A;git commit -m &quot;$(date)&quot;
git push -u origin main
<qsubb>###
</qsubb>
<qsuba>648_configure Nagvis map rotation pool:
</qsuba><qsubb>###
</qsubb>nn /etc/nagvis/etc/nagvis.ini.php

---
;99-1 maps=&quot;demo-germany,demo-ham-racks,demo-load,demo-muc-srv1,demo-geomap,demo-automap&quot;
;99+1
maps=&quot;KantarProfiles,demo-worldmap&quot;
;99
---
<qsubb>###
</qsubb>
<qsuba>647_configure customized maps:					# the same as 646, but done without WebGUI configure
</qsuba><qsubb>###
</qsubb>nn /etc/nagvis/etc/maps/KantarProfiles.cfg

---
define global {
sources=automap
object_id=0

#99+
label_maxlen=23
url_target=_blank
width=2048
height=1024
root=&lt;&lt;&lt;monitoring&gt;&gt;&gt;
backend_id=live_1
#99
}
---
<qsubb>###
</qsubb>
<qsuba>646_use Nagvis's auto-generated map with real time update of all status of Nagios:
</qsuba><qsubb>###
</qsubb>https://100.21.44.215/nagvis
admin / admin
Options / Manage Maps
Create Map:
ID (Internal Name):	KantarProfiles
Map Type:		Automap based on parent/child relations
Create
Then, you should see auto-generated map with real time update of all status of Nagios.
<qsubb>###
</qsubb>
<qsuba>645_install and configure Nagvis to map Nagios better:
</qsuba><qsubb>###
</qsubb>cd /opt/							# dependents:   yum install graphviz
wget -O nagvis-1.9.tar.gz 'https://www.dropbox.com/s/12eq7tudbw13lvu/nagvis-1.9.tar.gz?dl=0'
tar xvzf nagvis-1.9.tar.gz
cd nagvis-1.9
./install.sh
---
Valid socket formats are: tcp:127.0.0.1:7668 or unix:/path/to/live
Please enter your MKLivestatus socket: unix:/var/spool/nagios/cmd/live
---
systemctl reload nagios.service
<qsubb>###
</qsubb>
<qsuba>644_make Nagios has live status ready for other program, such Nagvis
</qsuba><qsubb>###
</qsubb>copy or download this file to location:
/etc/nagios/mk-livestatus/livestatus.o

nn /etc/nagios/nagios.cfg

#99+1
broker_module=/etc/nagios/mk-livestatus/livestatus.o /var/spool/nagios/cmd/live
#99

systemctl reload nagios.service

Then the live status of Nagios should be available here:
/var/spool/nagios/cmd/live
<qsubb>###
</qsubb>
<qsuba>643_advanced sample for page of pnp4nagios:
</qsuba><qsubb>###
</qsubb>nn /etc/pnp4nagios/pages/URL-response.cfg

define page {
  use_regex     1                       # 0 = use no regular expressions, 1 = use regular expressions
  page_name     URL-response            # page description
}

define graph {
  host_name     com$		# maych ANY host, which host_name ending with &quot;com&quot;
  service_desc  _HOST_          # means to use HOST perfdata which has NO service associated with
  source 0			# there are two graphs for each host, ONLY the first one we need, so this specifies it
}
<qsubb>###
</qsubb>
<qsuba>642_add page(s) for pnp4nagios:
</qsuba><qsubb>###
</qsubb>If you like to consolidate pnp4nagios's graph, you may add page(s)
So, if you visit https://100.21.44.215/pnp4nagios/page
you will see page(s) listed under &quot;Pages&quot;

nn /etc/pnp4nagios/pages/eo2atl-load.cfg

define page {
  use_regex     1                       # 0 = use no regular expressions, 1 = use regular expressions
  page_name     eo2atl-load             # page description
}

define graph {
  host_name     eo2atl??
  service_desc  load
}
<qsubb>###
</qsubb>
<qsuba>641_make customized check for Nagios, sample:
</qsuba><qsubb>###
</qsubb>01. nn /usr/lib64/nagios/plugins/is_FALCON_SENSOR
#!/bin/bash

PROC=falcon-sensor

if [ `ps aux|grep -v grep|grep $PROC|wc -l` == 1  ]
  then
    echo &quot;OK - $PROC is up&quot;
    exit 0
  else
    echo &quot;CRITICAL - $PROC is NOT up&quot;
    exit 2
fi

02. nn /etc/nagios/nrpe.cfg
#99+
command[is_falcon_sensor]=/usr/lib64/nagios/plugins/is_FALCON_SENSOR
#99

03. nn /etc/nagios/service/is_falcon_sensor.cfg
define service {
  use                   generic-service
  hostgroup_name        linux-servers
  service_description   falcon_sensor
  check_command         is_falcon_sensor
  servicegroups         falcon_sensor
}

04. nn /etc/nagios/service/is_falcon_sensor.cfg
define service {
  use                   generic-service
  hostgroup_name        linux-servers
  service_description   falcon_sensor
  check_command         is_falcon_sensor
  servicegroups         falcon_sensor
}
[root@kpadm01 nagios]# cat /etc/nagios/servicegroup/falcon_sensor.cfg
define servicegroup{
  servicegroup_name     falcon_sensor
}

05. nn /etc/nagios/command/is_falcon_sensor.cfg
define command{
  command_name  is_falcon_sensor
  command_line  $USER1$/check_nrpe -H $HOSTADDRESS$ -c is_falcon_sensor
} 
<qsubb>###
</qsubb>
<qsuba>640_setup at client host for Nagios active check:
</qsuba><qsubb>###
</qsubb>at Nagios server:
HOST=kpws01;ssh $HOST 'yum install -y nrpe'
HOST=kpws01;rsync -avz /etc/nagios/nrpe.cfg $HOST:/etc/nagios/
HOST=kpws01;rsync -avz /etc/nagios/send_nsca.cfg $HOST:/etc/nagios/
HOST=kpws01;rsync -avz /usr/lib64/nagios/plugins $HOST:/usr/lib64/nagios/
HOST=kpws01;ssh $HOST 'systemctl enable --now nrpe'
; test it
HOST=kpws01;/usr/lib64/nagios/plugins/check_nrpe -H $HOST -c check_load
<qsubb>###
</qsubb>
<qsuba>639_usage of dsh:
</qsuba><qsubb>###
</qsubb>export WCOLL=&quot;/home/apan/dsh/hosts&quot;				# hosts file has list of hosts
dsh -t sh uptime

alias dsh='dsh -t sh '						# make an alias to save typing &quot;dsh -t sh &quot;
<qsubb>###
</qsubb>
<qsuba>638_install dsh (distributed shell,yadsh):
</qsuba><qsubb>###
</qsubb>cd /opt/
mkdir dsh;cd $_
wget -O dsh-1.21.tar.gz 'https://www.dropbox.com/s/e0vbpiidgqb0x3a/dsh-1.21.tar.gz?dl=0'
tar xvzf dsh-1.21.tar.gz
cd dsh-1.21/
./configure
make
make install
cd
dsh -h
<qsubb>###
</qsubb>
<qsuba>637_configure service for Nagios:				# add service with hostgroup_name saved the trouble to add service to each host.
</qsuba><qsubb>###
</qsubb>nn /etc/nagios/service/MEM.cfg					# this line should be in nagios.cfg ALREADY
								# cfg_dir=/etc/nagios/service
define service {
  use                   generic-service
  hostgroup_name        windows-servers
  service_description   MEM
  check_command         check_MEM
  servicegroups         MEM
}

nn /etc/nagios/servicegroup/MEM.cfg                             # this line should be in nagios.cfg ALREADY
                                                                # cfg_dir=/etc/nagios/servicegroup
define servicegroup{
  servicegroup_name     MEM
}

nn /etc/nagios/command/check_MEM.cfg		                # this line should be in nagios.cfg ALREADY
                                                                # cfg_dir=/etc/nagios/command
define command{
  command_name  check_MEM
  command_line  $USER1$/check_nrpe -H $HOSTADDRESS$ -c alias_mem
}
<qsubb>###
</qsubb>
<qsuba>636_configure host for Nagios:
</qsuba><qsubb>###
</qsubb>nn /etc/nagios/host/EO2SDWWEB03.cfg				# this line should be in nagios.cfg ALREADY
                                                                # cfg_dir=/etc/nagios/host
define host {
  use           windows-server
  host_name     EO2SDWWEB03
  alias         EO2SDWWEB03
  address       EO2SDWWEB03.prod.kt.lcl
}

host_template: windows-server should be defined ALREADY
something like this:

define host {

    name                            windows-server          ; The name of this host template
    use                             generic-host            ; Inherit default values from the generic-host template
    check_period                    24x7                    ; By default, Windows servers are monitored round the clock
    check_interval                  5                       ; Actively check the server every 5 minutes
    retry_interval                  1                       ; Schedule host check retries at 1 minute intervals
    max_check_attempts              10                      ; Check each server 10 times (max)
    check_command                   check-host-alive        ; Default command to check if servers are &quot;alive&quot;
    notification_period             24x7                    ; Send notification out at any time - day or night
    notification_interval           30                      ; Resend notifications every 30 minutes
    notification_options            d,r                     ; Only send notifications for specific host states
    contact_groups                  admins                  ; Notifications get sent to the admins by default
    hostgroups                      windows-servers         ; Host groups that Windows servers should be a member of
    register                        0                       ; DON'T REGISTER THIS - ITS JUST A TEMPLATE
}

AND hostgroups is definded AREADY like this:

define hostgroup {
  hostgroup_name        windows-servers         ; The name of the hostgroup
  alias                 Windows Servers         ; Long name of the group
}
<qsubb>###
</qsubb>
<qsuba>635_setup pnp4nagios pop-up chart:
</qsuba><qsubb>###
</qsubb>nn /usr/share/nagios/html/ssi/status-header.ssi			# if file does NOT exist, just create it.

&lt;script src=&quot;/pnp4nagios/media/js/jquery-min.js&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;/pnp4nagios/media/js/jquery.cluetip.js&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;
&lt;script type=&quot;text/javascript&quot;&gt;
jQuery.noConflict();
jQuery(document).ready(function() {
  jQuery('a.tips').cluetip({ajaxCache: false, dropShadow: false,showTitle: false });
});
&lt;/script&gt;

AND make sure the pop-up settings are deployed in template file.
<qsubb>###
</qsubb>
<qsuba>634_setup pnp4nagios:
</qsuba><qsubb>###
</qsubb>yum install -y pnp4nagios php php-gd rrdtool perl-rrdtool perl-Time-HiRes		# PHP 5.4.16 is tested, higher version causes issue
nn /etc/nagios/nagios.cfg								# adding the whole block between --- and ---
---											# copied from /etc/pnp4nagios/nagios.cfg
#99-1 process_performance_data=0
#99+
process_performance_data=1

# *** the template definition differs from the one in the original nagios.cfg
#
service_perfdata_file=/var/log/pnp4nagios/service-perfdata
service_perfdata_file_template=DATATYPE::SERVICEPERFDATA\tTIMET::$TIMET$\tHOSTNAME::$HOSTNAME$\tSERVICEDESC::$SERVICEDESC$\tSERVICEPERFDATA::$SERVICE$
service_perfdata_file_mode=a
service_perfdata_file_processing_interval=15
service_perfdata_file_processing_command=process-service-perfdata-file

# *** the template definition differs from the one in the original nagios.cfg
#
host_perfdata_file=/var/log/pnp4nagios/host-perfdata
host_perfdata_file_template=DATATYPE::HOSTPERFDATA\tTIMET::$TIMET$\tHOSTNAME::$HOSTNAME$\tHOSTPERFDATA::$HOSTPERFDATA$\tHOSTCHECKCOMMAND::$HOSTCHECKC$
host_perfdata_file_mode=a
host_perfdata_file_processing_interval=15
host_perfdata_file_processing_command=process-host-perfdata-file
#99
---

nn /etc/nagios/objects/commands.cfg				# adding the whole block between --- and ---
---
#99-
#define command {
#
#    command_name    process-host-perfdata
#    command_line    /usr/bin/printf &quot;%b&quot; &quot;$LASTHOSTCHECK$\t$HOSTNAME$\t$HOSTSTATE$\t$HOSTATTEMPT$\t$HOSTSTATETYPE$\t$HOSTEXECUTIONTIME$\t$HOSTOUTPUT$\t$HOSTPERFDATA$\n&quot; &gt;&gt; /var/log/nagios/host-perfdata.out
#}
#
#define command {
#
#    command_name    process-service-perfdata
#    command_line    /usr/bin/printf &quot;%b&quot; &quot;$LASTSERVICECHECK$\t$HOSTNAME$\t$SERVICEDESC$\t$SERVICESTATE$\t$SERVICEATTEMPT$\t$SERVICESTATETYPE$\t$SERVICEEXECUTIONTIME$\t$SERVICELATENCY$\t$SERVICEOUTPUT$\t$SERVICEPERFDATA$\n&quot; &gt;&gt; /var/log/nagios/service-perfdata.out
#}
#99

#99+
#
# Bulk with NPCD mode
#
define command {
       command_name    process-service-perfdata-file
       command_line    /bin/mv /var/log/pnp4nagios/service-perfdata /var/spool/pnp4nagios/service-perfdata.$TIMET$
}

define command {
       command_name    process-host-perfdata-file
       command_line    /bin/mv /var/log/pnp4nagios/host-perfdata /var/spool/pnp4nagios/host-perfdata.$TIMET$
}
#99
---

nn /etc/nagios/objects/templates.cfg				# adding the whole block between --- and ---
---
#99+
define host {
   name       host-pnp
   action_url /pnp4nagios/index.php/graph?host=$HOSTNAME$&amp;srv=_HOST_
   # OR this, for pop-up chart: 
   #action_url /pnp4nagios/index.php/graph?host=$HOSTNAME$&amp;srv=_HOST_' class='tips' rel='/pnp4nagios/index.php/popup?host=$HOSTNAME$&amp;srv=_HOST_
   register   0
}

define service {
   name       service-pnp
   action_url /pnp4nagios/index.php/graph?host=$HOSTNAME$&amp;srv=$SERVICEDESC$
   # OR this, for pop-up chart:
   action_url /pnp4nagios/index.php/graph?host=$HOSTNAME$&amp;srv=$SERVICEDESC$' class='tips' rel='/pnp4nagios/index.php/popup?host=$HOSTNAME$&amp;srv=$SERVICEDESC$
   register   0
}
#99
---
AND make use of these two templates by adding one line at existing generic-host and generic-sercice
---
define host {

    name                            generic-host            ; The name of this host template
    use                             host-pnp                ;99+ to use pnp4nagios template
---
define service {

    name                            generic-service         ; The 'name' of this service template
    use                             service-pnp             ;99+ to use pnp4nagios template
---

nagios -v /etc/nagios/nagios.cfg
systemctl reload nagios.service
<qsubb>###
</qsubb>

<qsuba>633_setup mail for Nagios:
</qsuba><qsubb>###
</qsubb>; make sure the server postfix has been setup and running
cd /etc/nagios/
grep -Rn 'nagios@localhost' *								# check how many places using nagios@localhost
sed -i 's|nagios@localhost|alex.pan@kantar.com|g' {nagios.cfg,objects/contacts.cfg}
grep -Rn 'alex.pan@kantar.com' *							# verify after replacement
sed -i 's|pagealex.pan@kantar.com|alex.pan@kantar.com|g' nagios.cfg			# verify ALL have been replaced
nagios -v /etc/nagios/nagios.cfg							# verify configure files
systemctl reload nagios.service
<qsubb>###
</qsubb>
<qsuba>632_Install Nagios core on AWS Linux:
</qsuba><qsubb>###
</qsubb>amazon-linux-extras | grep epel
amazon-linux-extras enable epel
yum clean metadata
yum install epel-release
yum install nagios
systemctl enable --now nagios

https://100.21.44.215/nagios/
nagiosadmin / nagiosadmin

cd /etc/nagios/							# change default password, change of username will cause some problem!
cp passwd passwd.000
htpasswd -b /etc/nagios/passwd nagiosadmin it4gmi777
<qsubb>###
</qsubb>
<qsuba>631_Apache setup SSL with self-certified certificate:
</qsuba><qsubb>###
</qsubb>apachectl -V
apachectl -M | grep mod_ssl
yum install mod_ssl

openssl req -x509 -nodes -days 3650 -newkey rsa:2048 -keyout /etc/pki/tls/private/apache-selfsigned.key -out /etc/pki/tls/certs/apache-selfsigned.crt
openssl req -x509 -nodes -days 3650 -newkey rsa:2048 -keyout /etc/pki/tls/private/apache-selfsigned.key -out /etc/pki/tls/certs/apache-selfsigned.crt -subj &quot;/C=US/ST=WA/L=Seattle/O=Kantar/OU=Profiles/CN=kpadm01&quot;

nn /etc/httpd/conf.d/ssl.conf					# make changes like these:
#99-1 SSLCertificateFile /etc/pki/tls/certs/localhost.crt
#99+1
SSLCertificateFile /etc/pki/tls/certs/apache-selfsigned.crt

--
#99-1 SSLCertificateKeyFile /etc/pki/tls/private/localhost.key
#99+1
SSLCertificateKeyFile /etc/pki/tls/private/apache-selfsigned.key

cat /etc/httpd/conf.d/kpadm01.conf				# sample configuration for site: kpadm01
								# need to add IP kpadm01 pair to hosts file of client
&lt;VirtualHost *:80&gt;
    ServerName kpadm01
    ServerAlias kpadm01
    Redirect / https://kpadm01
&lt;/VirtualHost&gt;

&lt;VirtualHost *:443&gt;
    ServerName kpadm01
    ServerAlias kpadm01
    DocumentRoot /var/www/ssl-test
    SSLEngine on
    SSLCertificateFile /etc/pki/tls/certs/apache-selfsigned.crt
    SSLCertificateKeyFile /etc/pki/tls/private/apache-selfsigned.key
&lt;/VirtualHost&gt;

apachectl configtest
systemctl reload httpd						# Now, visit http://kpadm01 will be redirect to https://kpadm01 automatically
<qsubb>###
</qsubb>
<qsuba>630_Windows adhoc hosts file location:				C:\Windows\System32\drivers\etc\hosts
</qsuba>
<qsuba>629_check and test mail via relayhost, in this case, eo2mx01.prod.kt.lcl, on AWS Linux:
</qsuba><qsubb>###
</qsubb>ps aux|grep -v grep|grep postfix				# make sure postfix is up and running
rpm -qa|grep mailx						# make sure mailx is installed, otherwise:   yum install mailx

nn /etc/postfix/main.cf
; add this line:
relayhost = [eo2mx01.prod.kt.lcl]

systemctl reload postfix.service

SUBJECT='Test email from kpadm01.prod.kt.lcl';SMTP='eo2mx01.prod.kt.lcl';TO='alex.pan@kantar.com';ATTACHMENT='.tcshrc';mailx -v -s $SUBJECT -- smtp=smtp://$SMTP $TO &lt; $ATTACHMENT
tail /var/log/maillog						# should see something:
Mar 29 20:59:32 ip-10-74-156-89 postfix/qmgr[21997]: C62E8CA7AB: from=&lt;root@kpadm01.prod.kt.lcl&gt;, size=700, nrcpt=6 (queue active)
Mar 29 20:59:32 ip-10-74-156-89 postfix/smtp[22107]: C62E8CA7AB: to=&lt;alex.pan@kantar.com&gt;, relay=eo2mx01.prod.kt.lcl[10.74.144.242]:25, delay=1120, delays=1120/0.01/0.01/0, dsn=2.0.0, status=sent (250 2.0.0 Ok: queued as 0C05FCA7E0)
Mar 29 20:59:32 ip-10-74-156-89 postfix/qmgr[21997]: C62E8CA7AB: removed

ssh eo2mx01 'cat /var/log/maillog | grep alex.pan'		# should see something:
Mar 29 20:57:54 eo2mx01 postfix/smtp[17780]: E043ECA7E0: to=&lt;alex.pan@kantar.com&gt;, relay=mxb-00174f01.gslb.pphosted.com[67.231.156.205]:25, delay=1.8, delays=0.01/0/1.1/0.68, dsn=2.0.0, status=sent (250 2.0.0 37htvjrgda-1 Message accepted for delivery)
<qsubb>###
</qsubb>
<qsuba>628_setup relay host for postfix:
</qsuba><qsubb>###
</qsubb>grep relayhost /etc/postfix/main.cf

# The relayhost parameter specifies the default host to send mail to
# no relayhost is given, mail is routed directly to the destination.
relayhost = [eo2mx01.prod.kt.lcl]
<qsubb>###
</qsubb>
<qsuba>627_upgrade php on AWS Linux:
</qsuba><qsubb>###
</qsubb>amazon-linux-extras | grep php					# check what versions are available for php
amazon-linux-extras enable php7.4
php --version
yum clean metadata
yum install php-cli php-pdo php-fpm php-json php-mysqlnd
php --version
<qsubb>###
</qsubb>
<qsuba>626_php info test page:
</qsuba><qsubb>###
</qsubb>&lt;?php
echo $_SERVER[&quot;REMOTE_ADDR&quot;];
echo &quot;\n&quot;;
echo phpinfo();
?&gt;
<qsubb>###
</qsubb>
<qsuba>625_This took me more than FIVE hours to figure out:		How to ALLOW or DENY certain IPs to visit specific pages for virtual host
</qsuba><qsubb>###
</qsubb>#nano -w /etc/httpd/conf/virt/lsrint.conf
&lt;VirtualHost *:80&gt;
... ...
        #99+							
        &lt;IfModule mod_qos.c&gt;
          &lt;Location /ox0/qos&gt;
            SetHandler qos-viewer

          &lt;IfModule mod_rewrite.c&gt;
            RewriteEngine On
            RewriteCond %{REMOTE_ADDR} !^184\.65\.137\.3
            RewriteCond %{REMOTE_ADDR} !^50\.112\.140\.231
            RewriteRule (.*) https://kpws01.com			# if NOT from two IPs as listed above, redirect the traffic to https://kpws01.com
          &lt;/IfModule&gt;						# in another word, NOT allowed to visit https://kpws01.com/ox0/qos

          &lt;/Location&gt;
        &lt;/IfModule&gt;
... ...
&lt;/VirtualHost&gt;

Note on %{REMOTE_ADDR}:
You probably want the %{REMOTE_ADDR} to match against, but you can't use CIDR notation as the %{REMOTE_ADDR} is literally
the remote address and you can use a regular expression to try to match against it.
So for 123.45.67.89/28, (123.45.67.80 - 123.45.67.95), you'd have to do something like this:
RewriteCond %{REMOTE_ADDR} !^123\.45\.67\.8[0-9]$
RewriteCond %{REMOTE_ADDR} !^123\.45\.67\.9[0-5]$
Another sample:
RewriteCond %{REMOTE_ADDR} !^123\.45\.[0-9]{1,3}\.[0-9]{1,3}$
this will match any number from 0-255 in the third and fourth octets but let you define the first half of the IP.

For Apache HTTPD 2.4 or later, you can use expressions to match REMOTE_ADDR against a CIDR mask.
The short form looks like this:
RewriteCond expr &quot;-R '192.168.1.0/24'&quot;
Sample of usage for the above notation:
RewriteEngine On
RewriteCond %{REQUEST_URI} !/maintenance$
RewriteCond expr &quot;! -R '12.345.678.90/28'&quot;
RewriteRule $ /maintenance [R=302,L]
<qsubb>###
</qsubb>
<qsuba>624_check if a module is installed with Apache:			 apachectl -M | grep qos
</qsuba>
<qsuba>623_Configure Apache mod_qos, basic protection:
</qsuba>To limit the number of simultaneously inbound connections from a single IP. This will automatically prevent an user from creating more than x 
requests (specified at QS_SrvMaxConnPerIP) at the same time from the same device/network.
This is not a problem at all when there are more than x request at the same server from real persons as long as their connection isn't working
in the same way the Slowloris attack does, so if your application has access from more users than the specified at this property, they will be
able to access it as long as it's not a Slow HTTP request. Wonderful, isn't !?
<qsubb>###
</qsubb>nano -w /etc/httpd/conf.d/qos.conf

&lt;IfModule qos_module&gt;
   # handle connections from up to 100000 different IPs
   QS_ClientEntries 99999
   # allow only 50 connections per IP
   QS_SrvMaxConnPerIP 99
   # limit maximum number of active TCP connections limited to 256
   MaxClients 256
   # disables keep-alive when 180 (70%) TCP connections are occupied
   QS_SrvMaxConnClose 180
   # minimum request/response speed
   # (deny slow clients blocking the server, keeping connections open without requesting anything
   QS_SrvMinDataRate 150 1200
&lt;/IfModule&gt;

systemctl reload httpd.service
<qsubb>###
</qsubb>
<qsuba>622_implement Apache mod_qos, initial setup:
</qsuba><qsubb>###
</qsubb>mkdir -p /opt/mod_qos;cd $_
wget -O mod_qos-11.66.tar.gz 'https://www.dropbox.com/s/wy8vq08rxsrtcay/mod_qos-11.66.tar.gz?dl=0'
yum install httpd-devel
tar xvzf mod_qos-11.66.tar.gz
cd mod_qos-11.66/apache2
apxs -i -c mod_qos.c -lcrypto -lpcre				# dependency: yum install pcre-devel openssl-devel
cd ../..
ll /usr/lib64/httpd/modules/mod_qos.so				# target module installed
cd mod_qos-11.66/tools
./configure
make								# dependency: yum install automake libpng-devel

nano -w /etc/httpd/conf/httpd.conf				# enable the mod_qos
#99+
LoadModule qos_module modules/mod_qos.so

nano -w /etc/httpd/conf/virt/lsrint.conf			# add qos web viewer at one of virtual host
... ...
        #99+
        &lt;IfModule mod_qos.c&gt;
          &lt;Location /ox0/qos&gt;
            SetHandler qos-viewer
          &lt;/Location&gt;
        &lt;/IfModule&gt;
&lt;/VirtualHost&gt;

systemctl restart httpd.service

; Now you should see something here:				https://kpws01.com/ox0/qos
<qsubb>###
</qsubb>
<qsuba>621_AWS Linux extra package check:				which amazon-linux-extras; amazon-linux-extras | grep php
</qsuba>
<qsuba>620_capture client IP addresses in the web server logs behind an ELB:
</qsuba><qsubb>###
</qsubb>A. Use %{X-Forwarded-For}i in LogFormat of httpd.conf		# ONLY added source IP in the log file
nano -w /etc/httpd/conf/httpd.conf
; making these two lines like:
    ... ...
    LogFormat &quot;%{X-Forwarded-For}i %h %l %u %t \&quot;%r\&quot; %&gt;s %b \&quot;%{Referer}i\&quot; \&quot;%{User-Agent}i\&quot;&quot; combined
    LogFormat &quot;%h %l %u %t \&quot;%r\&quot; %&gt;s %b&quot; common
    ... ...

systemctl reload httpd.service

B. Use Apache mod_remoteip					# source IP as %{REMOTE_ADDR} is available for all Apache
nano -w /etc/httpd/conf/httpd.conf
; add this line
RemoteIPHeader X-Forwarded-For
<qsubb>###
</qsubb>
<qsuba>619_find and remove all files modified 7 days ago here!		find . -mtime +7 -exec rm -fv {} +
</qsuba><qsuba>618_find and list all files modified 7 days ago here!		find . -mtime +7 -exec ls -trhl {} +
</qsuba>
<qsuba>617_Sync date and time with time server (otherwise Grafana will not working properly):
</qsuba><qsubb>###
</qsubb>date
ntpdate pool.ntp.org		# wait few seconds !
date
<qsubb>###
</qsubb>
<qsuba>616_bat - a cat clone with syntax highlighting and Git integration.
</qsuba>pacman -Sy bat

<qsuba>615_Use .htaccess to force HTTP to HTTPs and protect certain files:
</qsuba><qsubb>###
</qsubb># cat .htaccess

# Enforce https regardless
RewriteEngine On
 RewriteCond %{HTTPS} off
 RewriteCond %{HTTP:X-Forwarded-Proto} =http
 RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]

# do not display the content of purpose.json
&lt;Files ~ &quot;purpose.json&quot;&gt;
    Order deny,allow
    Deny from all
&lt;/Files&gt;
<qsubb>###
</qsubb>
<qsuba>614_Command line to send email:
</qsuba>SUBJECT='check.uptime.yml';SMTP='10.74.144.242';TO='alex.pan@kantar.com';ATTACHMENT='check.uptime.yml';mailx -v -s $SUBJECT -- smtp=smtp://$SMTP $TO &lt; $ATTACHMENT

<qsuba>613_Linux add user and others:
</qsuba>set password as: ch@ngeMEs00n
<qsubb>###
</qsubb>#!/bin/bash
read -p 'Enter the userid : ' USERID
useradd -g GROUPID -d PATH_TO_HOME_DIRECTORY &quot;$USERID&quot;
echo &quot;$USERID&quot;:ch@ngeMEs00n | chpasswd
id &quot;$USERID&quot;
cat /etc/passwd | grep &quot;$USERID&quot;
<qsubb>###
</qsubb>
<qsuba>612_After ANY changes made under /var/nginx/html/pub/panyu101.github.io :
</qsuba><qsubb>###
</qsubb>FOLDER=XXXXXX;cd $FOLDER;tree -L 1 -I 'index.html' -T $FOLDER -H . | sed '/&lt;p class=&quot;VERSION&quot;&gt;/,+5d' &gt; index.html;cd -
FOLDER=panyu101.github.io;tree -L 1 -I 'index*|zz*|pdq*|*php' -T $FOLDER -H . | sed '/&lt;p class=&quot;VERSION&quot;&gt;/,+5d' &gt; pdq.html
du -h .		# to make sure it's UNDER 2G
git add -A;git commit -m &quot;$(date)&quot;
git push -u origin main
<qsubb>###
</qsubb>
<qsuba>611_Use .htaccess to control access to web folder when the server is behind AWS ELB:
</qsuba><qsubb>###
</qsubb>Under the folder, nano -w .htaccess

SetEnvIF X-Forwarded-For &quot;184.65.137.33&quot; AllowIP	# for network 192.168.0.0/24, use: 192.168.0
SetEnvIF X-Forwarded-For &quot;198.178.235.170&quot; AllowIP

ErrorDocument 403 //internal/denied.html		# shows the error page when &quot;Access denied&quot;

&lt;RequireAny&gt;
Require env AllowIP
&lt;/RequireAny&gt;
<qsubb>###
</qsubb>
<qsuba>610_Github Repositories actual command tested:
</qsuba><qsubb>###
</qsubb>Adding SSH key:
eval &quot;$(ssh-agent -s)&quot;
ssh-add ../panyu101.rsa

Testing the ssh connection:
ssh -T git@github.com

For NOT initialized directory (there is NO .get under TARGET_DIRECTORY):
cd TARGET_DIRECTORY
git config --global user.email panyu101@gmail.com
git init;git add -A;git commit -m &quot;$(date)&quot;;git branch -M main;git remote add origin git@github.com:panyu101/XXXXXXXXX.git
git push -u origin main

For ANY change made under TARGET_DIRECTORY
git add -A;git commit -m &quot;$(date)&quot;
git push -u origin main				git push -f origin main
<qsubb>###
</qsubb>
<qsuba>609_Github Repositories:
</qsuba><qsubb>###
</qsubb>https://github.com/login
account:   panyu101
password:  il...YW..&amp;JWBSman...
SSH private key:   panyu101.rsa

go:   https://github.com/panyu101?tab=repositories   New   in this case, se2bind01.named

create a new repository on the command line:
echo &quot;# se2bind01.named&quot; &gt;&gt; README.md
git init
git add README.md
git commit -m &quot;first commit&quot;
git branch -M main
git remote add origin git@github.com:panyu101/se2bind01.named.git
git push -u origin main

push an existing repository from the command line:
git remote add origin git@github.com:panyu101/se2bind01.named.git
git branch -M main
git push -u origin main
<qsubb>###
</qsubb>
<qsuba>608_Python rename a file if the file does NOT exist:
</qsuba><qsubb>###
</qsubb>import os.path

target = photo_home+'/'+year+'/'+folder+'/'+photo
if not os.path.isfile(target+'.JPG'):
  old_file = os.path.join(photo_home+'/'+year+'/'+folder, photo)
  new_file = os.path.join(photo_home+'/'+year+'/'+folder, photo+'.JPG')
  os.rename(old_file, new_file)
  print(old_file)
  print(new_file)
<qsubb>###
</qsubb>
<qsuba>607_mount Windows filesystem to Linux with special file/directory permission:
</qsuba>mount -t cifs -o vers=3.0 //192.168.56.1/family/photo /var/nginx/html/photo -o username=apan,password=XXXXXXXXX,file_mode=0777,dir_mode=0777,nounix

<qsuba>606_fixed space in html:
</qsuba><qsubb>###
</qsubb>css part:
qspan {
  display: inline-block;
  width: 99px;
}

html part:
&lt;qspan&gt; ANY_TEXT_WANTS_TO_BE_SPACED_HERE &lt;/qspan&gt;
<qsubb>###
</qsubb>
<qsuba>605_make background picture full window, simplest code:
</qsuba><qsubb>###
</qsubb>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
        &lt;title&gt;OOPS&lt;/title&gt;
        &lt;style&gt;
        html {
          background: url(oops.png) no-repeat center center fixed;
          -webkit-background-size: cover;
          -moz-background-size: cover;
          -o-background-size: cover;
          background-size: cover;
        }
        &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;/body&gt;
&lt;html&gt;
<qsubb>###
</qsubb>
<qsuba>604_top 10 processes on system for opening filesL		lsof | awk '{print $1}' | sort | uniq -c | sort -r -n | head
</qsuba>
<qsuba>603_publish maillog report to website:
</qsuba><qsubb>###
</qsubb>#!/bin/bash

Y=$(date -d &quot;1 day ago&quot; '+%Y')
M=$(date -d &quot;1 day ago&quot; '+%m')
D=$(date -d &quot;1 day ago&quot; '+%d')
mkdir -p /var/www/html/logwatch/$Y/$M

F=/var/www/html/logwatch/$Y/$M/$Y-$M-$D.html
echo '&lt;pre&gt;' &gt; $F
perl /usr/sbin/pflogsumm -e -d yesterday /var/log/maillog &gt;&gt; $F
<qsubb>###
</qsubb>
<qsuba>602_send maillog report via email:				http://192.168.56.211/cli/usr.sbin.pflogsumm.txt
</qsuba><qsubb>###
</qsubb>#!/bin/bash

perl /usr/sbin/pflogsumm -e -d today /var/log/maillog  | grep -B999 'Senders by message count' | grep -v 'Senders by message count' | mail -s &quot;eo2mx01 mail server daily report at $(date)&quot; it-saas@gmi-mr.com
<qsubb>###
</qsubb>
<qsuba>601_Bash check type of files exist or not:			if [ `ls -1 *.JGP 2&gt;/dev/null | wc -l` -gt 0 ];then echo &quot;FILES EXIST&quot;;else echo &quot;FILES DON'T EXIST&quot;;fi
</qsuba>
<qsuba>600_Windos hosts file(and it does work) at location:		C:\Windows\System32\drivers\etc
</qsuba>
<qsuba>599_LAMP server install with yum:
</qsuba><qsubb>###
</qsubb>echo '&gt;&gt; Installing Apache, MariaDB, and PHP'

yum install -y httpd mariadb-server mariadb php php-mysql
systemctl enable --now httpd.service mariadb.service
mysql_secure_installation

firewall-cmd --permanent --zone=public --add-service=http
firewall-cmd --permanent --zone=public --add-service=https
firewall-cmd --reload
<qsubb>###
</qsubb>
<qsuba>598_restore tar directory, in this case, /home:			cd /;tar xvzf home.tar.gz
</qsuba>
<qsuba>597_tar whole directory, in this case, /home:			tar -zcvpf home.tar.gz /home
</qsuba>
<qsuba>596_Manually create a Linux swap in filesystem:
</qsuba><qsubb>###
</qsubb>fallocate -l 1G /swapfile
chmod 600 /swapfile
mkswap /swapfile
swapon /swapfile
sh -c 'echo &quot;/swapfile none swap sw 0 0&quot; &gt;&gt; /etc/fstab'
<qsubb>###
</qsubb>
<qsuba>595_Python add note to video via HTTP GET method, sample:	http://192.168.56.211/video/add.py?video=&quot;2020/10-12/2020-11-07_XJ.open.gift.on.bday.01.mp4&quot;&amp;note=&quot;打开爷爷、奶奶给的两岁生日礼物&quot;
</qsuba>
<qsuba>594_Python replace special character with another one:
</qsuba><qsubb>###
</qsubb>import re

year=re.sub('&quot;', '', paths[0])
<qsubb>###
</qsubb>
<qsuba>593_Python split long string by special character into a list:
</qsuba><qsubb>###
</qsubb>import re

paths = re.split('\/', whole_path)
<qsubb>###
</qsubb>
<qsuba>592_pass parameter to php
</qsuba><qsubb>###
</qsubb>URL:	http://192.168.56.211/video/index.php?year=2020		# index.php can be omitted
code:
&lt;?php
$year = isset($_GET[&quot;year&quot;]) ? $_GET[&quot;year&quot;] : &quot;2021&quot;;
?&gt;
<qsubb>###
</qsubb>
<qsuba>591_bash arguemnt check
</qsuba><qsubb>###
</qsubb>#!/bin/bash

if [[ $# -ne 1 ]]
  then
    echo -e &quot;$0\tPROMPT_FOR_ARGUMENT&quot;
    exit 1
fi
<qsubb>###
</qsubb>
<qsuba>590_python professional template:
</qsuba><qsubb>###
</qsubb>#!/usr/bin/python3

import argparse

def main():
  parser = argparse.ArgumentParser(description='List the content of a folder')
  parser.add_argument(&quot;arg1&quot;)
  parser.add_argument(&quot;arg2&quot;)
  args = parser.parse_args()
  print(args)

if __name__=='__main__':
  main()
<qsubb>###
</qsubb>
<qsuba>589_python read files and iceream usage:
</qsuba><qsubb>###
</qsubb>from icecream import ic

a = open(&quot;001a.txt&quot;, &quot;r&quot;)
lines = a.readlines()
ic(lines)

b = open(&quot;001b.txt&quot;, &quot;r&quot;)
notes = b.read()
ic(notes)

c = open(&quot;001c.txt&quot;, &quot;r&quot;)
indexs = c.readlines()
ic(indexs)
<qsubb>###
</qsubb>
<qsuba>588_html template:
</qsuba><qsubb>###
</qsubb>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
  &lt;meta charset=&quot;utf-8&quot;&gt;
  &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;XXXXXXXXX.css&quot;&gt;
  &lt;title&gt;XXXXXXXXX&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;/body&gt;
&lt;/html&gt;
<qsubb>###
</qsubb>
<qsuba>587_php foreach item in array:
</qsuba><qsubb>###
</qsubb>&lt;?php
$colors = array(&quot;red&quot;, &quot;green&quot;, &quot;blue&quot;, &quot;yellow&quot;);
print_r($colors);
foreach ($colors as $color) {
  echo &quot;$color &lt;br&gt;&quot;;
}
?&gt;
<qsubb>###
</qsubb>
<qsuba>586_usage of html anchor tag with taxt clicable:
</qsuba><qsubb>###
</qsubb>&lt;a href=&quot;../../ap/XJ/supercucos/$folder_name/$file_name#t=$start_at&quot;&gt;
  &lt;img src=&quot;../../ap/XJ/supercucos/$folder_name/$file_name.jpg&quot; style=&quot;height:250px;&quot;&gt;
&lt;/a&gt;
<qsubb>###
</qsubb>
<qsuba>585_usage of html video tag:
</qsuba><qsubb>###
</qsubb>&lt;video height=&quot;$height_video&quot; controls  poster=&quot;../../ap/XJ/supercucos/$folder_name/$file_name.jpg&quot;&gt;
  &lt;source src=&quot;../../ap/XJ/supercucos/$folder_name/$file_name#t=$start_at&quot; type=&quot;video/mp4&quot;&gt;
&lt;/video&gt;
<qsubb>###
</qsubb>
<qsuba>584_mapping VSCOde shortcut:
</qsuba><qsubb>###
</qsubb>To map, type ctrl+k, ctrl+s. Type one of the commands, right-click, choose change keybinding, enter whatever you want the binding to be.
<qsubb>###
</qsubb>
<qsuba>583_print content of the CRT file:				openssl x509 -noout -text -in eo2mx01_kpsugar_com.crt
</qsuba><qsuba>582_print content of the CSR file:				openssl req -noout -text -in corp-mx.gmi-mr.com.2021.csr
</qsuba><qsuba>581_create new CSR (Certificate SSL Request) file:
</qsuba><qsubb>###
</qsubb>openssl req -new -newkey rsa:2048 -nodes -out corp-mx.gmi-mr.com.2021.csr -keyout corp-mx.gmi-mr.com.2021.key -subj &quot;/C=US/ST=WA/L=Seattle/O=Kantar/OU=OPS/CN=eo2mx01.kpsugar.com&quot;
Generating a 2048 bit RSA private key
..................................................................................................................................+++
....+++
writing new private key to 'corp-mx.gmi-mr.com.2021.key'
-----

ls -l
total 8
-rw-r--r-- 1 root root 1005 Feb 10 17:34 corp-mx.gmi-mr.com.2021.csr
-rw-r--r-- 1 root root 1704 Feb 10 17:34 corp-mx.gmi-mr.com.2021.key
<qsubb>###
</qsubb>
<qsuba>580_check certificate end date with cert file:			openssl x509 -enddate -noout -in eo2mx01_kpsugar_com.crt
</qsuba><qsuba>579_check mail server certificate content via DNS:		openssl s_client -starttls smtp -crlf -connect eo2mx01.kpsugar.com:25
</qsuba><qsuba>578_check DNS certificate expring date via file:		openssl x509 -enddate -noout -in /etc/postfix/ssl/eo2mx01_kpsugar_com.crt
</qsuba><qsuba>577_check DNS certificate expring date via http:		DNS=www.google.com;echo | openssl s_client -servername $DNS -connect $DNS:443 2&gt;/dev/null | openssl x509 -noout -issuer -subject -dates
</qsuba><qsuba>576_solve error:						-bash: ./975.argument.py: /usr/bin/python^M: bad interpreter: No such file or directory
</qsuba><qsubb>###
</qsubb>sed -i 's|^M||g' 975.argument.py
[ to type in ^M, press ctrl+v,ctrl+m ]
<qsubb>###
</qsubb>
<qsuba>575_include outside script in html:				&lt;script src=&quot;coolclock.js&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;
</qsuba><qsuba>574_php heredoc (EOT can be ANYTHING):				use 'EOT' is nowdoc, meaning it will NOT evaluate $VAR inside the doc
</qsuba><qsubb>###
</qsubb>echo &lt;&lt;&lt; EOT
&lt;/pre&gt;&lt;/body&gt;&lt;/html&gt;
EOT;
<qsubb>###
</qsubb>
<qsuba>573_mail in action:
</qsuba><qsubb>###
</qsubb>mailx -s &quot;XXXXXXXXX&quot; alex.pan@kantar.com &lt;&lt; EOF

This message was sent at $(date) from ec2corpweb01 at AWS us-east-1 PROD.
EOF
<qsubb>###
</qsubb>
<qsuba>572_separate variable name from letters in string:		ANIMAL=&quot;Dog&quot;;echo &quot;${ANIMAL}s are the best.&quot;
</qsuba><qsuba>571_untar XXX.tar.gz to current directory:			tar xvfz XXX.tar.gz
</qsuba><qsuba>570_tar or zip the whole directory:				tar -zcvf mytarfile.tgz.gz mydir/
</qsuba>								tar -zcvf lightspeedresearch.tar.gz /var/www/html/lightspeedresearch.com
<qsuba>569_html template:
</qsuba><qsubb>###
</qsubb>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
        &lt;meta charset=&quot;utf-8&quot;&gt;
        &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;XXX.css&quot;&gt;
        &lt;title&gt;XXX&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;/body&gt;
&lt;html&gt;
<qsubb>###
</qsubb>
<qsuba>568_rotate a picture with name of FILE:				FILE=XXX.jpg;ROTATE='-90';convert $FILE -rotate $ROTATE $FILE.000;rm -fv $FILE;mv $FILE.000 $FILE
</qsuba><qsuba>567_cut return off when don't need it:				echo -e $i &quot;\t&quot; | tr -d &quot;\n&quot; &gt;&gt; $FILE
</qsuba>
<qsuba>566_bash script to check if designed arguments provided:
</qsuba><qsubb>###
</qsubb>#!/bin/bash

if [[ $# -ne 2 ]]
  then
  echo -e &quot;./make.index.columnized\tCOLUMNS(25)\WEB_FOLDER(.ent/97)&quot;
  exit 1
fi

COLUMNS=$1
WEB_FOLDER=$2
<qsubb>###
</qsubb>
<qsuba>565_number can be devided by 5 or not:				number=99;[ `expr $number % 5` -eq 0 ];echo $?
</qsuba><qsuba>564_check if today is Wednesday:				if [ `date +\%u` = 3 ];then echo &quot;Today is Wednesday&quot;;else echo &quot;Today is NOT Wednesday&quot;;fi
</qsuba><qsuba>563_html refresh/reload page every 30 seconds:			&lt;meta http-equiv=&quot;refresh&quot; content=&quot;30&quot;&gt;
</qsuba><qsuba>562_html set charset for Chinese and others:			&lt;meta charset=&quot;UTF-8&quot;&gt;
</qsuba><qsuba>561_POM, solve less photos in the year get less show:		cat /root/bin/update.pom|grep -v ^#|grep .
</qsuba><qsubb>###
</qsubb>YEAR=$(cut -c1-4 /var/nginx/html/list.all.photos|uniq|sort|shuf -n1)
THIS=$(grep ^$YEAR /var/nginx/html/list.all.photos|shuf -n1)
while [ `echo $THIS|grep -i 'kids\|hangout\|party\|memory\|celebrity\|Czech\|UK\|Germany\|Li.Juan'` ]
  do
  THIS=$(shuf -n1 /var/nginx/html/list.all.photos)
done
cp /var/nginx/html/photo/$THIS /var/nginx/html/pom/this.one.jpg
cat &lt;&lt; EOF &gt; /var/nginx/html/pom/link.html
&lt;a href=../photo/$THIS target=_blank&gt;$THIS&lt;/a&gt;
EOF
<qsubb>###
</qsubb>
<qsuba>560_POM - Picture Of Moment NOT select pictures with:		cat /root/bin/update.pom|grep -v ^#|grep .
</qsuba><qsubb>###
</qsubb>THIS=$(shuf -n1 /var/nginx/html/list.all.photos)
while [ `echo $THIS|grep -i 'kids\|hangout\|party\|memory\|celebrity\|Czech\|UK\|Germany\|Li.Juan'` ]
  do
  THIS=$(shuf -n1 /var/nginx/html/list.all.photos)
done
cp /var/nginx/html/photo/$THIS /var/nginx/html/pom/this.one.jpg
cat &lt;&lt; EOF &gt; /var/nginx/html/pom/link.html
&lt;a href=../photo/$THIS target=_blank&gt;$THIS&lt;/a&gt;
EOF
<qsubb>###
</qsubb>
<qsuba>559_manually bring up wifi					cat /root/wifi.up
</qsuba><qsubb>###
</qsubb>#wpa_passphrase SHAW-725B10 &gt;&gt; /etc/wpa_supplicant.conf
wpa_supplicant -B -i wlp0s29f7u6 -c /etc/wpa_supplicant.conf
sleep 3
dhcpcd
<qsubb>###
</qsubb>
<qsuba>558_install Arch Linux on old Dell D810 laptop:
</qsuba><qsubb>###
</qsubb>passwd
ip l
wpa_passphrase SHAW-725B10 &gt;&gt; /etc/wpa_supplicant.conf
wpa_supplicant -B -i wlan0 -c /etc/wpa_supplicant.conf
dhcpcd
ip a
systemctl start sshd
;fdisk and format
lsblk
fdisk -l
mkfs.ext4 /dev/sda1
swapon /dev/sda2
free -h
mount /dev/sda1 /mnt
df -h
;download and install package
pacman -Sy
pacman -Q|wc -l
pacman -Sy archlinux32-keyring
pacstrap /mnt base linux linux-firmware base-devel dhcpcd wpa_supplicant wget sudo ntp man-db man-pages openssh nano
genfstab -U /mnt &gt;&gt; /mnt/etc/fstab
pacman -Q|wc -l
arch-chroot /mnt                                                now in the NEW system
pacman -Q|wc -l
;setup in new system
date
ln -sf /usr/share/zoneinfo/America/Vancouver /etc/localtime
date
hwclock --systohc
date
;make bootable image etc
mkinitcpio -P
passwd
pacman -S grub os-prober nano
pacman -S openssh
grub-install --target=i386-pc /dev/sda
grub-mkconfig -o /boot/grub/grub.cfg
nano -w /boot/grub/grub.cfg
;extra package
pacman -S dialog netctl dhcp
pacman -Q|wc -l
;configure sshd
nano -w /etc/ssh/sshd_config					PermitRootLogin yes / UseDNS no / GSSAPIAuthentication no
systemctl enable sshd
exit                                                            from &quot;arch-chroot /mnt&quot;, back to USB booted system
;reboot to new system
reboot                                                          remove USB drive first
;manually setup wifi connection
ip l
ip a
wpa_passphrase SHAW-725B10 &gt;&gt; /etc/wpa_supplicant.conf
wpa_supplicant -B -i wlp0s29f7u6 -c /etc/wpa_supplicant.conf
dhcpcd
ip a
<qsubb>###
</qsubb>
<qsuba>557_solve Putty shows tablet line as b chracter:		Setting / Window / Translation / Enable VT 100 line drawing even in UTF-8 mode / Apply
</qsuba><qsuba>556_solve issue of &quot;invalid or corrupted package&quot;:		pacman -Sy archlinux32-keyring | pacman -Sy archlinux-keyring
</qsuba>
<qsuba>555_Setup wifi on Arch Linux
</qsuba><qsubb>###
</qsubb>wpa_passphrase SHAW-725B10-5G &gt;&gt; /etc/wpa_supplicant.conf
wpa_supplicant -B -D wext -i wlan0 -c /etc/wpa_supplicant.conf
dhcpcd
<qsubb>###
</qsubb>
<qsuba>554_pacman's mirror list file location:				/etc/pacman.d/mirrorlist
</qsuba><qsuba>553_usage of named pipe, sample:
</qsuba>open terminal A for watching:					watch -n 3 &quot;ps aux|grep -v grep|grep 'wget\|pipe'&quot;
open terminal B to bring up the pipe reader in backgroud:	cd /var/nginx/html/.ent/000;./rpipe &amp;
work at terminal B to add URL in wpipe for processing:		./wpipe https://www.nudecollect.com/content/Hegre-Art_Lulu_Bondage_Part1_x87/image-2-pics-20-mirror-6.html &amp;

<qsuba>552_wait a moment till condition meet:
</qsuba><qsubb>###
</qsubb>while [ $(ps aux|grep -v grep|grep -c '/bin/bash ./rpipe') -gt $MAX ]
   do
      sleep $MOMENT
done
<qsubb>###
</qsubb>
<qsuba>551_a very basic nginx.conf for start:				cat /etc/nginx/nginx.conf|grep -v \#|grep .
</qsuba><qsubb>###
</qsubb>worker_processes  1;
events {
    worker_connections  1024;
}
http {
    include       mime.types;
    default_type  application/octet-stream;
    sendfile        on;
    keepalive_timeout  65;
    include /etc/nginx/upstream/*.conf;
    server {
        listen       80;
        server_name  localhost;
        root         /var/nginx/html/pub;
        include /etc/nginx/location/*.conf;
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   /usr/share/nginx/html;
        }
    }
}
<qsubb>###
</qsubb>
<qsuba>550_included upstream conf files, sample for php-fpm:		cat /etc/nginx/upstream/php-fpm.conf
</qsuba><qsubb>###
</qsubb># PHP-FPM FastCGI server
# network or unix domain socket configuration
upstream php-fpm {
        #server unix:/run/php-fpm/www.sock;
        server unix:/run/php-fpm/php-fpm.sock;
}
<qsubb>###
</qsubb>
<qsuba>549_included location conf files, sample for php:		cat /etc/nginx/location/php.conf
</qsuba><qsubb>###
</qsubb># pass the PHP scripts to FastCGI server
#
# See conf.d/php-fpm.conf for socket configuration
#
index index.php index.html index.htm;
location ~ \.(php|phar)(/.*)?$ {
    fastcgi_split_path_info ^(.+\.(?:php|phar))(/.*)$;
    fastcgi_intercept_errors on;
    fastcgi_index  index.php;
    include        fastcgi_params;
    fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;
    fastcgi_param  PATH_INFO $fastcgi_path_info;
    fastcgi_pass   php-fpm;
}
<qsubb>###
</qsubb>
<qsuba>548_create a soft link:						ln -s original.txt othername.txt
</qsuba><qsuba>547_create a hard link:						ln original.txt othername.txt
</qsuba><qsuba>546_upload the current folder to aws s3:			F=$(basename $(pwd));export AWS_PROFILE=ratox;aws s3 sync . s3://alex.eboy.work/audio/79_KennyG/$F --delete --exclude zz --region us-west-2
</qsuba><qsuba>545_check if named pipe file exists, otherwise create:		if [ ! -p pipe ];then mkfifo pipe;fi
</qsuba><qsuba>544_bash addition/increment way 1:				n=1;for i in {01..11};do echo $i $n;n=$[$n+1];done
</qsuba><qsuba>543_bash addition/increment way 2:				n=1;for i in {01..11};do echo $i $n;n=$((n+1));done
</qsuba>
<qsuba>542_make two hosts talking with bash:
</qsuba>on host A, 192.168.0.39						netcat  -lvp 7777
on host B, 192.168.0.20						bash -i &gt; /dev/tcp/192.168.0.39/7777 0&lt;&amp;1 2&gt;&amp;1
now, B's bash has been placed at A's till exit issued

<qsuba>541_query time server with one line bash command:		cat &lt; /dev/tcp/time.nist.gov/13
</qsuba><qsuba>540_find out listening port at output of /proc/net/tcp:		anything connecting to a remote of 0.0.0.0:0 is a listening port.
</qsuba><qsuba>539_readable tcp connection stat:				awk -f /root/bin/net.stat.readable.awk /proc/net/tcp
</qsuba><qsuba>538_readable udp connection stat:                               awk -f /root/bin/net.stat.readable.awk /proc/net/udp
</qsuba>
<qsuba>537_cat /root/bin/net.stat.readable.awk
</qsuba><qsubb>###
</qsubb>function hextodec(str,ret,n,i,k,c){
    ret = 0
    n = length(str)
    for (i = 1; i &lt;= n; i++) {
        c = tolower(substr(str, i, 1))
        k = index(&quot;123456789abcdef&quot;, c)
        ret = ret * 16 + k
    }
    return ret
}
function getIP(str,ret){
    ret=hextodec(substr(str,index(str,&quot;:&quot;)-2,2));
    for (i=5; i&gt;0; i-=2) {
        ret = ret&quot;.&quot;hextodec(substr(str,i,2))
    }
    ret = ret&quot;:&quot;hextodec(substr(str,index(str,&quot;:&quot;)+1,4))
    return ret
}
NR &gt; 1 {{if(NR==2)print &quot;local_address \t\t rem_address&quot;;local=getIP($2);remote=getIP($3)}{print local&quot; \t\t &quot;remote}}
<qsubb>###
</qsubb>
<qsuba>536_list of ALL current TCP connections:			cat /proc/net/tcp
</qsuba><qsuba>535_list of ALL current UDP connections:                        cat /proc/net/udp
</qsuba>
<qsuba>534_list of ALL current TCP connections with remote ip readable:
</qsuba>### grep -v &quot;rem_address&quot; /proc/net/tcp  | awk  '{x=strtonum(&quot;0x&quot;substr($3,index($3,&quot;:&quot;)-2,2)); for (i=5; i&gt;0; i-=2) x = x&quot;.&quot;strtonum(&quot;0x&quot;substr($3,i,2))}{print x&quot;:&quot;strtonum(&quot;0x&quot;substr($3,index($3,&quot;:&quot;)+1,4))}'

<qsuba>533_list of ALL current TCP connections with local ip readable:
</qsuba>### grep -v &quot;local_address&quot; /proc/net/tcp  | awk  '{x=strtonum(&quot;0x&quot;substr($2,index($2,&quot;:&quot;)-2,2)); for (i=5; i&gt;0; i-=2) x = x&quot;.&quot;strtonum(&quot;0x&quot;substr($2,i,2))}{print x&quot;:&quot;strtonum(&quot;0x&quot;substr($2,index($3,&quot;:&quot;)+1,4))}'

<qsuba>532_make named pipe working over network
</qsuba>on host 192.168.0.39						netcat  -lvp 7777						
on host 192.168.0.20						mkfifo &gt;&amp; /dev/tcp/192.168.0.39/7777
on host 192.168.0.39						netcat  -lvp 7777
on host 192.168.0.20						script -f &gt;&amp; /dev/tcp/192.168.0.39/7777 0&gt;&amp;2
								0&gt;&amp;2 means .20 stdin redirected to &amp;
now, whatever you type at .39 is actually at .20
and the output at .39 is from .20
type &quot;exit&quot; to finish the session

<qsuba>531_use script and mkfifo to share terminal activity
</qsuba>in real-time with other user
on terminal A:							mkfifo /tmp/share.screen;script -f /tmp/share.screen
on terminal B:							cat /tmp/share.screen
then whatever typed or outputed on terminal A will be on B
untill &quot;exit&quot; typed on A
clean up:							rm -fv /tmp/share.screen

<qsuba>530_randomized color output:					SOMETHING='Hello Color!';COLOR=&quot;$(( $RANDOM * 6 / 32767 + 1 ))&quot;;echo  -e &quot;\e[0;3${COLOR}m$SOMETHING&quot;
</qsuba>
<qsuba>529_install sshd and allow root:				pacman -S openssh;nano -w /etc/ssh/sshd_config
</qsuba>### PermitRootLogin yes						systemctl enable --now sshd

<qsuba>528_Arch Linux uses ~/.bash_profile instead of ~/.bashrc	source ~/.bash_profile
</qsuba><qsuba>527_enable directory list under Nginx:				add &quot;autoindex   on;&quot; under location stanza in /etc/nginx.conf;systemctl restart nginx
</qsuba><qsuba>526_install nginx php php-fpm:					pacman -S nginx php php-fpm;nn /etc/nginx/nginx.conf;systemctl enable --now nginx php-fpm
</qsuba><qsuba>525_install ansible, boto3 (after AWS cli installed):		pip install ansible;ansible --version;pip install boto3
</qsuba><qsuba>524_install AWS cli:						mkdir -p /opt/aws;cd $_;curl &quot;https://bootstrap.pypa.io/get-pip.py&quot; -o &quot;get-pip.py&quot;;python get-pip.py;pip install awscli --upgrade;aws --version
</qsuba><qsuba>523_install Azure cli:						mkdir -p /opt/az;cd $_;pacman -S python;python --version;curl -L https://aka.ms/InstallAzureCli | bash;/root/bin/az --version
</qsuba><qsuba>522_upload FOLDER to Azure:					cd FOLDER;FOLDER=$(basename $(pwd));/root/bin/az storage blob upload-batch -s . -d '$web'/$FOLDER --account-name eboy --connection-string &quot;DefaultEndpointsProtocol=https;AccountName=eboy;AccountKey=gyVGDM95LatUBvnR2gsP78DMwU0Dk2SGUqcwDeK7Ir3FnD/FaJQp4+D4mSqAUl7CHl/kQvdoAGL/2GJEFs7lAA==;EndpointSuffix=core.windows.net&quot;
</qsuba>
<qsuba>521_make a new disk, format and mount
</qsuba><qsubb>###
</qsubb>lsblk
fdisk -l
fdisk /dev/sda
p
n,p,1,enter,enter
p
w
<qsubb>###
</qsubb>continue ...							mkfs.xfs /dev/sda1;mount /dev/sda1 /mnt

<qsuba>520_get bell ring:						echo -ne '\007'
</qsuba><qsuba>519_setup hostname:						hostnamectl set-hostname s21a | nn /etc/hostname
</qsuba>
<qsuba>518_setup a static interface:					nn /etc/systemd/network/enp0s8.network
</qsuba><qsubb>###
</qsubb>[Match]
Name=enp0s8

[Network]
Address=192.168.56.39/24
DNS=64.59.144.18
DNS=64.59.150.134

[Route]
Gateway=192.168.56.1
Metric=1009
<qsubb>###
</qsubb>continue ...							systemctl enable --now systemd-networkd | systemctl restart systemd-networkd

<qsuba>517_delete a route:						ip route del default via 192.168.56.1 dev enp0s8
</qsuba><qsuba>516_my favorite alias:						alias ll=&quot;ls --color -al&quot; grep=&quot;grep --color &quot;  nn=&quot;nano -w &quot; qq=&quot;clear&quot;
</qsuba><qsuba>515_how many package installed:					pacman -Q|wc -l
</qsuba><qsuba>514_install sar:						pacman -S sysstat
</qsuba><qsuba>513_remote copy the folder, retired to:				rsync -avz retired 192.168.56.39:/root/bin/
</qsuba><qsuba>512_create Influxdb with API call:				curl -i -XPOST http://localhost:8086/query --data-urlencode &quot;q=CREATE DATABASE s21a&quot;
</qsuba><qsuba>511_restore Influxdb from file:					influxd restore -portable -db weather /opt/weather
</qsuba><qsuba>510_back up Influxdb to file:					influxd backup -portable -db weather /opt/weather
</qsuba><qsuba>509_show Influxdb with API query:				curl -sG http://127.0.0.1:8086/query --data-urlencode &quot;q=SHOW DATABASES&quot;|jq .
</qsuba><qsuba>508_list ALL running service:					systemctl|grep running|grep .
</qsuba><qsuba>507_php-fpm.d session file default location:			/tmp/systemd-private-19152feb544f4bb898c407f0467dac66-php-fpm.service-hS2C0i/tmp/
</qsuba><qsuba>506_find php-fpm.d session file default location:		grep -Rn session.save_path /etc/php/*
</qsuba>
<qsuba>505_install samba:						pacman -S samba;nn /etc/samba/smb.conf
</qsuba><qsubb>###
</qsubb>[s21a]
    comment = s21a
    path = /
    #valid users = someusers, somegroup
    force user = root
    force group = root
    #admin users = someusers, somegroup
    writeable = Yes
<qsubb>###
</qsubb>continue ...							smbpasswd -a root;systemctl enable --now {smb,nmb};systemctl status {smb,nmb}

<qsuba>504_install influxdb:						pacman -S influxdb;systemctl enable --now influxdb
</qsuba><qsuba>503_install grafana:						pacman -S grafana;systemctl enable --now grafana
</qsuba>
<qsuba>502_solve grafana proxy error, adding /etc/grafana.ini:		right before database stanza
</qsuba><qsubb>###
</qsubb># 99+below
# to solve issue as: If you're seeing this Grafana has failed to load its application files ... because Nginx proxy settings
domain = eboy.work
root_url = %(protocol)s://%(domain)s:%(http_port)s/grafana7/
serve_from_sub_path = true
# 99+above
<qsubb>###
</qsubb>
<qsuba>501_install Arch Linux:
</qsuba><qsubb>###
</qsubb>passwd
systemctl start sshd
; from other box:   ssh root@IP
; make a new disk, format and mount
pacman -Sy
pacman -S archlinux-keyring
pacstrap /mnt base linux linux-firmware base-devel dhcpcd wpa_supplicant wireless_tools wget vim-minimal sudo ntp man-db man-pages
genfstab -U /mnt &gt;&gt; /mnt/etc/fstab
;
arch-chroot /mnt
ls /usr/share/zoneinfo/*/*|grep -i vancouver
ln -sf /usr/share/zoneinfo/America/Vancouver /etc/localtime
hwclock --systohc
mkinitcpio -P
passwd
pacman -S grub os-prober nano
grub-install --target=i386-pc /dev/sda
grub-mkconfig -o /boot/grub/grub.cfg
nn /boot/grub/grub.cfg
### change timeout from 5 to 1
pacman -S dialog netctl dhcp
exit
;
reboot / remove the ISO disk
pacman -S openssh
systemctl enable --now dhcpcd
<qsubb>###
</qsubb>
<hr></hr>
<qsuba>428_install rsyslog on CentOS 8 to enable /var/log/secure log etc.
</qsuba><qsubb>###
</qsubb>rpm -qa|grep rsyslog
ps aux|grep rsyslog
dnf install rsyslog
rpm -qa|grep rsyslog
systemctl enable --now rsyslog
ps aux|grep rsyslog
<qsubb>###
</qsubb>
<qsuba>427_solve routing issue after added hostonly network on CentOS 8 virtual box:
</qsuba><qsubb>###
</qsubb>;change route to make ping www.google.com possible
route add -net 0.0.0.0 gw 192.168.56.1 netmask 0.0.0.0 dev enp0s3 metric 109
route del -net 0.0.0.0 gw 192.168.56.1 netmask 0.0.0.0 dev enp0s3 metric 100
;ip route version of the above
ip route del default via 192.168.56.1 dev enp0s3 metric 100
ip route add default via 192.168.56.1 dev enp0s3 metric 109
;these changes made by the command line will be reversed after rebooting
;resolve the problem by:
;adding /etc/sysconfig/network-scripts/route-enp0s3 with the content:
default via 192.168.56.1 dev enp0s3 metric 109
nano -w /etc/sysconfig/network-scripts/ifcfg-enp0s3 one line:
# from
DEFROUTE=&quot;yes&quot;
# to
DEFROUTE=&quot;no&quot;
<qsubb>###
</qsubb>
<qsuba>426_setup alias etc on CentOS 8
</qsuba><qsubb>###
</qsubb>nano -w ~/.bashrc
;adding

#99+below
alias ll='ls -lh'
alias nn='nano -w'
alias cc='clear'

HISTSIZE=-1
HISTFILESIZE=-1
export PROMPT_COMMAND='history -a'
<qsubb>###
</qsubb>
<qsuba>425_setup static IP on CentOS 8:				nano -w /etc/sysconfig/network-scripts/ifcfg-enp0s9
</qsuba>#BOOTPROTO=dhcp
<qsubb>###
</qsubb>BOOTPROTO=static
IPADDR=192.168.0.20
NETMASK=255.255.255.0
<qsubb>###
</qsubb>
<qsuba>424_install samba and enable to run it on CentOS 8:
</qsuba><qsubb>###
</qsubb>dnf install samba &amp;&amp; systemctl enable --now {smb,nmb}
ps aux|grep 'smb\|nmb'
;add samba to open the firewall
firewall-cmd --permanent --add-service=samba &amp;&amp; firewall-cmd --reload &amp;&amp; firewall-cmd --list-all
;check what ports are for service samba
firewall-cmd --info-service samba
;to make samba root accessiable
cp -p /etc/samba/smb.conf /etc/samba/smb.conf.000
echo &gt; /etc/samba/smb.conf
nano -w /etc/samba/smb.conf
#####
[s20]
    comment = s20
    path = /
    #valid users = someusers, somegroup
    force user = root
    force group = root
    #admin users = someusers, somegroup
    writeable = Yes
#####
smbpasswd -a root &amp;&amp; systemctl restart {smb,nmb}
setenforce 0    ;otherwise /root/ is NOT accessiable
<qsubb>###
</qsubb>
<qsuba>423_install netlify and deploy site on CentOS 8:
</qsuba><qsubb>###
</qsubb>;home place for netlify at: /root/netlify
;notes at /root/netlify/zz
curl -sL https://rpm.nodesource.com/setup_10.x | sudo bash -
dnf module enable -y nodejs
dnf install -y nodejs
npm install netlify-cli -g
;you will see something like (only for the first time from THIS computer):
;open a browser and click authorize
https://app.netlify.com/authorize?response_type=ticket&amp;ticket=f6b0da14f763226083bd7cdbf64cdaa0
<qsubb>###
</qsubb>
<qsuba>422_install Nginx on CentOS 8:
</qsuba><qsubb>###
</qsubb>dnf install  nginx
ps aux|grep nginx
systemctl enable --now nginx
ps aux|grep nginx
firewall-cmd --permanent --add-service=http &amp;&amp; firewall-cmd --reload &amp;&amp; firewall-cmd --list-all
cp -p /etc/nginx/nginx.conf /etc/nginx/nginx.conf.000
rsync -avz 192.168.0.220:/etc/nginx/nginx.conf /etc/nginx/
mkdir -p /var/nginx/html
systemctl restart nginx
<qsubb>###
</qsubb>
<qsuba>421_install ImageMagick to have conver to process jpg file:
</qsuba><qsubb>###
</qsubb>rpm -qa|grep ImageMagick
dnf install epel-release
dnf info ImageMagick
dnf install ImageMagick
rpm -qa|grep ImageMagick
<qsubb>###
</qsubb>
<qsuba>420_install aws, ansible, boto on CentOS 8:
</qsuba><qsubb>###
</qsubb>dnf update
dnf install python3
python3 --version
curl &quot;https://bootstrap.pypa.io/get-pip.py&quot; -o &quot;get-pip.py&quot;
python3 get-pip.py
pip install awscli --upgrade
pip install ansible
pip install boto3
aws --version
<qsubb>###
</qsubb>
<qsuba>419_rsync from host 192.168.0.20 to here:			rsync -avz 192.168.0.20:/root/.aws .
</qsuba><qsuba>418_add authorized key (public key):				cd ~/.ssh/;nano -w authorized_keys;chmod 0600 authorized_keys
</qsuba><qsuba>417_add RSA id (private key):					cd ~/.ssh/;nano -w id_rsa;chmod 0600 id_rsa
</qsuba>
<qsuba>416_install chrony on CentOS 8:					check and enalbe chronyd to keep system time updated automatically
</qsuba><qsubb>###
</qsubb>date
rpm -qa|grep chrony
systemctl status chronyd
systemctl enable --now chronyd
systemctl status chronyd
chronyc sources
date
<qsubb>###
</qsubb>
<qsuba>415_test ansible playbook against AWS
</qsuba><qsubb>###
</qsubb>cd ~/ansible
time export AWS_PROFILE=lsr-prod;time ansible-playbook test.yml
time export AWS_PROFILE=lsr-prod;aws cloudformation delete-stack --region us-west-2 --stack-name asm-test
<qsubb>###
</qsubb>
<qsuba>414_deploy ANY change for site http://alex.eboy.work/:		cd XXXXXX/; export AWS_PROFILE=ratox;aws s3 sync . s3://alex.eboy.work/XXXXXX --delete --exclude zz --region us-west-2
</qsuba><qsuba>413_do all git to push local change to GitHub:			cd XXXXXX/; git add . ; git commit . -m &quot;$(date)&quot; ; git push
</qsuba><qsuba>412_connect to GitHub account and test:				eval &quot;$(ssh-agent -s)&quot; &amp;&amp; ssh-add ~/key/panyu101.rsa &amp;&amp; ssh -T git@github.com
</qsuba>
<qsuba>411_add influxdb repo for CentOS 8:
</qsuba><qsubb>###
</qsubb>cat &lt;&lt; EOF &gt; /etc/yum.repos.d/influxdb.repo
[influxdb]
name = InfluxDB Repository
baseurl = https://repos.influxdata.com/rhel/7/x86_64/stable/
enabled = 1
gpgcheck = 1
gpgkey = https://repos.influxdata.com/influxdb.key
EOF
<qsubb>###
</qsubb>
<qsuba>410_add grafana repo for CentOS 8:
</qsuba><qsubb>###
</qsubb>cat &lt;&lt; EOF &gt; /etc/yum.repos.d/grafana.repo
[grafana]
name=grafana
baseurl=https://packages.grafana.com/oss/rpm
repo_gpgcheck=1
enabled=1
gpgcheck=1
gpgkey=https://packages.grafana.com/gpg.key
sslverify=1
sslcacert=/etc/pki/tls/certs/ca-bundle.crt
EOF
<qsubb>###
</qsubb>
<qsuba>409_open grafana port at firewall:				firewall-cmd --permanent --add-service=grafana &amp;&amp; firewall-cmd --reload &amp;&amp; firewall-cmd --list-all
</qsuba><qsuba>408_check if port 3000 for grafana defination xml exists:	grep 3000 /usr/lib/firewalld/services/*
</qsuba><qsuba>407_show Influxdb with API query:				curl -sG http://127.0.0.1:8086/query --data-urlencode &quot;q=SHOW DATABASES&quot;|jq .
</qsuba>
<qsuba>406_create github repository from the scratch:
</qsuba>cd /root/XXXXXX
rm -rf .git/    ; if it exists already
nano -w .gitignore   ; adding files you do NOT want to push to GitHub
git init . ; git add . ; git commit . -m &quot;first&quot;
git remote add origin https://panyu101@github.com/panyu101/XXXXXX.git
git push -u origin master
need password:          il...YW..&amp;JWBSman...

<qsuba>405_setup and use git:
</qsuba>cd /root/XXXXXX
eval &quot;$(ssh-agent -s)&quot;
ssh-add ~/key/panyu101.rsa
ssh -T git@github.com
git config --global user.email &quot;panyu101@outlook.com&quot;
git config --global user.name &quot;panyu101&quot;
git add . ; git commit . -m &quot;$(date)&quot; | git init . ; git add . ; git commit . -m &quot;first time&quot;
git status
git push

<qsuba>404_git push keeps asking for password while the ssh key has been deployed:
</qsuba>cat .git/config
<qsubb>###
</qsubb>[core]
        repositoryformatversion = 0
        filemode = true
        bare = false
        logallrefupdates = true
[remote &quot;origin&quot;]
        url = ssh://panyu101@github.com/panyu101/bin
# if this is  https://panyu101@github.com/panyu101/bin , then it will keep ask for password if you do git push !
# or use this one for universal fit
#        url = git@github.com:panyu101/bin.git
        fetch = +refs/heads/*:refs/remotes/origin/*
[branch &quot;master&quot;]
        remote = origin
        merge = refs/heads/master
<qsubb>###
</qsubb>
<qsuba>403_az login:							To sign in, use a web browser to open the page https://microsoft.com/devicelogin and enter the code XXXXXXXXX to authenticate.
</qsuba><qsuba>402_disable selinux permanently:				nano -w /etc/sysconfig/selinux;### SELINUX=disabled
</qsuba><qsuba>401_disable selinux:						setenforce 0
</qsuba>
<hr></hr>
<qsuba>337_console-like style for html:
</qsuba><qsubb>###
</qsubb>&lt;style&gt;
body {
  color: #0b0;
  background: #111;
  text-align: left;
}
pre {
  font-family: Consolas;
}
z {
  color: #999;
  margin-top: 0;
  margin-bottom: 0;
  margin-left: 99;
  margin-right: 0;
}
&lt;/style&gt;
&lt;pre&gt;
&lt;z&gt;XXX XXX XXX&lt;/z&gt;
<qsubb>###
</qsubb>
<qsuba>336_one line to deploy static website to AWS s3:		cd /root/aws.s3/alex.eboy.work;export AWS_PROFILE=ratox;aws s3 sync . s3://alex.eboy.work/ --delete
</qsuba><qsuba>335_one line to sort out Apache access from IPs:		cat /var/log/httpd/access_log* |awk '{print }'|awk '{a[-bash]++}END{for(i in a){print a[i],i}}'|sort -rn
</qsuba><qsuba>334_one line to connect to GitHub account and test:		eval &quot;$(ssh-agent -s)&quot; &amp;&amp; ssh-add ~/.ssh/panyu101.rsa &amp;&amp; ssh -T git@github.com
</qsuba><qsuba>333_one line do all git to push local change to GitHub, check at https://github.com/panyu101/ansible:
</qsuba>### cd /root/ansible ; git add . ; git commit . -m &quot;$(date)&quot; ; git push

<qsuba>332_mount Windows box E driver to Linux:			mount -t cifs //192.168.0.20/e$ /mnt/ap16dt.E -o username=apan,password=X..LJ..
</qsuba><qsuba>331_add samba to open the firewall:				firewall-cmd --permanent --add-service=samba &amp;&amp; firewall-cmd --reload &amp;&amp; firewall-cmd --list-all
</qsuba><qsuba>330_check what ports are for service samba:			firewall-cmd --info-service samba
</qsuba><qsuba>329_execute each line in LIST_FILE as long as these lines are good BASH commands:
</qsuba>### cat LIST_FILE | xargs -0 bash -c

<qsuba>328_one line to enable and start the service:			systemctl enable --now grafana-server
</qsuba><qsuba>327_check if it is Wednesday today:				if [ `date +\%u` = 3 ];then echo &quot;Wednesday&quot;;else echo &quot;NOT Wednesday&quot;;fi
</qsuba><qsuba>326_cron task to setup at the third Wednesday of a month:	09 15 15-21 * 3
</qsuba><qsuba>325_print ONLY from line FROM to line TO in FILE_NAME:		FROM=20;TO=29;FILE=FILE_NAME;sed -n -e &quot;$FROM,$TO p&quot; -e &quot;$TO q&quot; $FILE
</qsuba><qsuba>324_send email to someone as from someone:			mail -r &quot;Donald.Trump@whitehouse.org&quot; -s &quot;Test mail subject&quot; alex.pan.can@gmail.com &lt;&lt;&lt; &quot;Test msg body&quot;
</qsuba><qsuba>323_download the entier website:				wget -mkEpnp www.eboy.work/Adrian
</qsuba><qsuba>322_list size and directies in current folder:			du -sh ./*/
</qsuba><qsuba>321_nmap find all alive hosts in a subnet:			nmap -sP 10.74.156.*
</qsuba><qsuba>320_list aws region all running instance private IPs:		aws --profile lsr-prod --region us-west-2 --output json ec2 describe-addresses | jq -r '.Addresses[].PrivateIpAddress'
</qsuba><qsuba>319_list aws region all running instance public IPs:		aws --profile lsr-prod --region us-west-2 --output json ec2 describe-addresses | jq -r '.Addresses[].PublicIp'
</qsuba><qsuba>318_httpd total memory in use:					ps -C httpd -o rss --no-headers | awk '{SUM += $1} END {printf(&quot;%.0f\n&quot;,SUM/1024)}'
</qsuba><qsuba>317_rsync from remote to local with non-standard ssh port:	rsync -avz -e &quot;ssh -p $portNumber&quot; user@remote.host:/path/to/copy /local/path
</qsuba><qsuba>316_rsync from remote to local:					rsync -chavzP --stats user@remote.host:/path/to/copy /path/to/local/storage
</qsuba><qsuba>315_generate random IPv4 address:				for i in a b c d; do echo -n $(($RANDOM % 256)).; done | sed -e &quot;s/\.$//g&quot;; echo
</qsuba><qsuba>314_kill all Zombie processes one-liner:			ps axo state,ppid | awk '!/PPID/$1~&quot;Z&quot;{print $2}' | xargs -r kill -9
</qsuba><qsuba>313_sort IPv4 address in order, sort option:			sort -V ~/ip.txt
</qsuba><qsuba>312_display remote DNS full SSL info:				DNS=google.com;openssl s_client -showcerts -servername $DNS -connect $DNS:443 &amp;LT/dev/null | sed -ne &quot;/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p&quot; | openssl x509 -noout -subject -dates
</qsuba><qsuba>311_display SSL expiration date for a domain:			DNS=google.com;echo | openssl s_client -servername $DNS -connect $DNS:443 2&gt;/dev/null | openssl x509 -noout -enddate
</qsuba><qsuba>310_pretty format of id output:					id &lt;user_name&gt; | sed 's/,/\n/g' | tr ' ' '\n'
</qsuba><qsuba>309_a good way to write to SDCard, sample of useage of dd:	dd if=&lt;image&gt; of=/dev/sdx bs=4M iflag=direct,fullblock oflag=direct status=progress
</qsuba><qsuba>308_remove files that were modified 30 days ago:		find . -mtime +30 -type f -exec rm -rf {} \;
</qsuba><qsuba>307_number of CPU's in a system:				grep -cE &quot;^processor&quot; /proc/cpuinfo
</qsuba><qsuba>306_directory listing and serve folder on port 8000 with php -S, need php -v over 5.4
</qsuba><qsubb>###
</qsubb>tree -H '.' -L 1 &gt; index.html &amp;&amp; php -S $(hostname -I|awk '{print $1}'):8000 &amp;&amp; rm -fv index.html
<qsubb>###
</qsubb>
<qsuba>305_sort installed rpms by size:				rpm -qa --queryformat '%{size} %{name}\n' | sort -n
</qsuba><qsuba>304_allow ONLY private network ssh with iptables:		iptables -I INPUT -p tcp ! -s 192.168.0.0/24 --dport 22 -j DROP
</qsuba><qsuba>303_list sub dir, sort by size, the biggest at the end, with human presentation, du example:
</qsuba><qsubb>###
</qsubb>du --max-depth=1 -x -k | sort -n | awk 'function human(x) { s=&quot;KMGTEPYZ&quot;; while (x&gt;=1000 &amp;&amp; length(s)&gt;1) {x/=1024; s=substr(s,2)} return int(x+0.5) substr(s,1,1)&quot;iB&quot; } {gsub(/^[0-9]+/, human($1)); print}'
du -h --max-depth=1 | sort -h
<qsubb>###
</qsubb>
<qsuba>302_randomize to sleep 0 to 3 seconds:				time sleep $(($RANDOM % 3))
</qsuba><qsuba>301_draw a line across the entire width of the terminal:	for ((i=0; i&lt;$(tput cols); i++)); do echo -e &quot;_\c&quot; ;done
</qsuba>
<hr></hr></pre></body></html>